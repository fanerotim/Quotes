const request = require('supertest');
const { createTestApp } = require('../../controllers/tests/createTestApp');
const app = createTestApp();

const quoteService = require('../../services/quoteService');
jest.mock('../../services/quoteService');

let { auth } = require('../authMiddleware');
jest.mock('../authMiddleware')

const user = {
    id: 1,
    email: 'test@abv.bg',
    password: 123
};

describe('tests auth middleware', () => {

    const quotes = [
        {
            id: 1,
            author: `Hunter Thompson`,
            text: `Life should not be a journey to the grave with the intention of arriving safely in a pretty and well preserved body, but rather to skid in broadside in a cloud of smoke, thoroughly used up, totally worn out, and loudly proclaiming "Wow! What a Ride!`,
            category: `Fiction`,
            ownerId: 1
        },
        {
            id: 2,
            author: `Allen Ginsberg`,
            text: `I don't think there is any truth. There are only points of view.`,
            category: 'Fiction',
            ownerId: 2
        }
    ]

    test('allows us to view /quotes page as no access token is required', () => {
        // expect.assertions(3);

        auth.mockImplementationOnce((req, res, next) => {
            res.user = null;
            next();
        })

        return request(app)
            .get('/quotes')
            .expect(200)
            .then(response => {
                console.log(res.user);
            })
    });
})
